{% extends "index.html" %}

{% block content %}
<h1>Your Visual Novels</h1>
<div class="row mt-5">
  {% for visual_novel in visual_novels|reverse %}
  <div class="col-md-4">
    <div class="card">
      <img src="{{ url_for('static', filename=visual_novel.title + '/cover.png') }}" class="card-img-top" alt="Visual Novel Thumbnail">
      <div class="card-body">
        <h5 class="card-title">{{ visual_novel.title }}</h5>
        <button type="button" class="btn btn-primary read-btn" data-novel-id="{{ visual_novel.id }}"onclick='onReadButtonClick(this, {{ visual_novel.dialogues|tojson }}, {{ visual_novel.title|tojson }}, "{{ url_for('static', filename=visual_novel.title + '/cover.png') }}")'>Read</button>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<div class="modal fade" id="bookModal" tabindex="-1" role="dialog" aria-labelledby="bookModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content" id="modal-content">
      <!-- Modal content will be loaded dynamically -->
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
  {% include 'novel.html' %}
  <script>
    $(document).ready(function() {
      const urlParams = new URLSearchParams(window.location.search);
      const novelId = urlParams.get('novel_id');
      if (novelId) {
        // Find the Read button for the novel with the given novel ID
        const readButton = document.querySelector(`.read-btn[data-novel-id="${novelId}"]`);
        if (readButton) {
          // Trigger a click event on the Read button to open the modal view
          readButton.click();
        }
      }
    });
  </script>
{% endblock %}